# yaml-language-server: $schema=https://github.com/epics-containers/ioc-adaravis/releases/download/2024.1.2/ibek.ioc.schema.json

ioc_name: "{{ _global.get_env('IOC_NAME') }}"

description: auto-generated by https://github.com/epics-containers/builder2ibek

entities:
  - type: epics.EpicsCaMaxArrayBytes
    max_bytes: 6000000

  - type: epics.StartupCommand
    command: callbackSetQueueSize(10000)
    # name: ASYN_CALLBACK_SIZE

  - type: devIocStats.iocAdminSoft
    IOC: "{{ ioc_name | upper }}"

  - type: ADAravis.aravisCamera
    CLASS: AVT_Mako_G234B
    ID: bl45p-ea-detector-02
    P: BL45P-EA-DIFF-01
    PORT: DIFF.DET
    R: ":DET:"

  - type: ADCore.NDROI
    ADDR: 0
    NDARRAY_ADDR: 0
    NDARRAY_PORT: DIFF.DET
    P: BL45P-EA-DIFF-01
    PORT: DIFF.roi
    QUEUE: 250
    R: ":ROI:"
    TIMEOUT: 1

  - type: ADCore.NDStats
    ADDR: 0
    HIST_SIZE: 256
    NCHANS: 20000
    NDARRAY_ADDR: 0
    NDARRAY_PORT: DIFF.DET
    P: BL45P-EA-DIFF-01
    PORT: DIFF.stat
    QUEUE: 250
    R: ":STAT:"
    TIMEOUT: 1
    XSIZE: 1936
    YSIZE: 1216

  - type: ADCore.NDStdArrays
    ADDR: 0
    FTVL: UCHAR
    NDARRAY_ADDR: 0
    NDARRAY_PORT: DIFF.roi
    NELEMENTS: 2354176
    P: BL45P-EA-DIFF-01
    PORT: DIFF.arr
    QUEUE: 2
    R: ":ARR:"
    TIMEOUT: 1
    TYPE: Int8

  - type: ADCore.NDProcess
    ADDR: 0
    NDARRAY_ADDR: 0
    NDARRAY_PORT: DIFF.DET
    P: BL45P-EA-DIFF-01
    PORT: DIFF.proc
    QUEUE: 250
    R: ":PROC:"
    TIMEOUT: 1

  # - type: ADCore.NDOverlay
  #   ADDR: 0
  #   NDARRAY_ADDR: 0
  #   NDARRAY_PORT: DIFF.proc
  #   P: BL45P-EA-DIFF-01
  #   PORT: DIFF.over
  #   QUEUE: 250
  #   R: ":OVER:"
  #   TIMEOUT: 1

  - type: ADCore.NDFileTIFF
    ADDR: 0
    NDARRAY_ADDR: 0
    NDARRAY_PORT: DIFF.DET
    P: BL45P-EA-DIFF-01
    PORT: DIFF.tiff
    QUEUE: 250
    R: ":TIFF:"
    TIMEOUT: 1

  - type: ADCore.NDFileHDF5
    ADDR: 0
    NDARRAY_ADDR: 0
    NDARRAY_PORT: DIFF.DET
    P: BL45P-EA-DIFF-01
    PORT: DIFF.hdf
    QUEUE: 250
    R: ":HDF5:"
    TIMEOUT: 1

  # - type: ADCore.NDCircularBuff
  #   NDARRAY_PORT: DIFF.DET
  #   P: BL45P-EA-DIFF-01
  #   PORT: DIFF.BUFF
  #   R: ":BUFF:"

  - type: ADCore.NDPosPlugin
    ENABLED: 1
    NDARRAY_PORT: DIFF.DET
    P: BL45P-EA-DIFF-01
    PORT: DIFF.POS
    QUEUE: 1000
    R: ":POS:"

  - type: ADCore.NDPvaPlugin
    ENABLED: 1
    NDARRAY_PORT: DIFF.DET
    PVNAME: BL45P-EA-DIFF-01:TX:PVA
    PORT: DIFF.PVA
    P: BL45P-EA-DIFF-01
    R: ":PVA:"
